<!DOCTYPE html>
<html lang="es-pe"><head>
  <meta charset="utf-8">
  <title>El Programador | Blog personal</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Microsoft SQL Server es un sistema de gestión de base de datos relacional (RDBMS) producido por Microsoft. Su principal lenguaje de consulta es Transact-SQL..">
  <meta name="author" content="Hugo Roca">
  <meta name="generator" content="Hugo 0.58.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://examplesite.com/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://examplesite.com/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://examplesite.com/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://examplesite.com/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://examplesite.com/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://examplesite.com/images/favicon.ico " type="image/x-icon">
  <link rel="icon" href="https://examplesite.com/images/favicon.ico " type="image/x-icon">
  <link rel="stylesheet" href="https://examplesite.com/css/syntax.css">

  <link rel="stylesheet" href="https://examplesite.com/highlight/styles/atom-one-light.css ">
  <script src="https://examplesite.com/highlight/highlight.pack.js" type='text/javascript'></script>
  

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head><body>
<!-- preloader start -->
<div class="preloader">
  
</div>
<!-- preloader end -->
<!-- navigation -->
<header class="navigation">
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://examplesite.com"><img class="img-fluid"
          src="https://examplesite.com/images/logo.png" alt="El Programador | Blog personal"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu h3"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <div class="desktop-view">
          <ul class="navbar-nav mr-auto">
            
            <li class="nav-item">
              <a class="nav-link" href="mailto:hugo.rock20@hotmail.com"><i class="ti-email"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://twitter.com/HuugooRoca"><i class="ti-twitter-alt"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="skype:hugo.rock20?chat"><i class="ti-skype"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/HugoRoca"><i class="ti-github"></i></a>
            </li>
            
            <li class="nav-item">
              <a class="nav-link" href="https://www.linkedin.com/in/hugoroca/"><i class="ti-linkedin"></i></a>
            </li>
            
          </ul>
        </div>

        <a class="navbar-brand mx-auto desktop-view" href="https://examplesite.com"><img class="img-fluid"
            src="https://examplesite.com/images/logo.png" alt="El Programador | Blog personal"></a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://examplesite.com/about">Acerca</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://examplesite.com/blog">Post</a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://examplesite.com/contact">Contacto</a>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://examplesite.com/search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Escriba y pulsa enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        
        <a href="/categories/tutoriales"
          class="text-primary">Tutoriales</a>
        
        <h2>Conexión NodeJS con SQLServer</h2>
        <div class="mb-3 post-meta">
          <span>Por Hugo Roca</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>10/01/2019</span>
          
        </div>
        
        <img src="https://examplesite.com/images/post/2019-01-10-nodejs-sqlserver.jpg" class="img-fluid w-100 mb-4" alt="Conexión NodeJS con SQLServer">
        
        <div class="content mb-5">
          

<blockquote>
<p>Microsoft SQL Server es un sistema de gestión de base de datos relacional (RDBMS) producido por Microsoft. Su principal lenguaje de consulta es Transact-SQL, una aplicación de las normas ANSI / ISO estándar Structured Query Language (SQL) utilizado por ambas Microsoft y Sybase.</p>
</blockquote>

<p>Usaremos clases y funcion asincronas con promesas en javascript ES6.</p>

<h3 id="creando-el-package-json">Creando el Package.json</h3>

<p>Antes de proceder con cualquier instalación de paquetes npm necesitamos crear nuestro package.json.</p>

<ul>
<li>Como primer paso creamos una carpeta donde estarán todos nuestros archivos.</li>
<li>Luego, levantar la ventana de comandos dentro de la carpeta y ejecutar el siguiente comando <code>npm init</code>.</li>
<li>Podemos personalizar o simplemente precionar la tecla enter hasta terminar.</li>
</ul>

<p>Al finalizar tendremos un archivo como este:</p>

<pre><code>{
  &quot;name&quot;: &quot;[nombre]&quot;,
  &quot;version&quot;: &quot;[versión]&quot;,
  &quot;description&quot;: &quot;[descripción]&quot;,
  &quot;main&quot;: &quot;&quot;,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;author&quot;: &quot;Hugo Roca - hugo.rock20@hotmail.com&quot;,
  &quot;license&quot;: &quot;[licencia]&quot;
}
</code></pre>

<hr />

<h3 id="instalando-npm-mssql">Instalando npm mssql</h3>

<p>Para este caso utilizaremos al paquete mssql (<a href="https://www.npmjs.com/package/mssql">https://www.npmjs.com/package/mssql</a>), en la consola de comandos copiamos y pegamos lo siquiente: <code>npm i mssql</code>, una ves terminado se creará una carpeta por defecto <code>node_modules</code>, en donde se guardan todas las dependencias.</p>

<hr />

<h3 id="creando-tabla-y-store-procedure">Creando tabla y store procedure</h3>

<p>En SQLServer ejecutamos el siguiente script, que nos creará las tablas, creará datos y store procedures.</p>

<pre><code>CREATE DATABASE NodeSQLPruebas
GO
USE NodeSQLPruebas
GO

CREATE TABLE test(
id int identity(1,1),
descripcion varchar(200),
fecha datetime
primary key (id)
)
GO

insert into test(descripcion, fecha) values('Lorem ipsum dolor sit amet, consectetur adipiscing elit.', getdate())
insert into test(descripcion, fecha) values('Mauris sagittis, dolor vitae posuere sollicitudin, sem lorem euismod nunc, quis consectetur dolor augue ac turpis.', getdate())
insert into test(descripcion, fecha) values('Phasellus in dui vitae magna placerat aliquam eget nec velit.', getdate())
insert into test(descripcion, fecha) values('Praesent ut arcu in nunc eleifend aliquam vel id metus.', getdate())
insert into test(descripcion, fecha) values('Ut ac lectus fringilla felis imperdiet malesuada.', getdate())
insert into test(descripcion, fecha) values('Morbi at mattis turpis.', getdate())
insert into test(descripcion, fecha) values('Cras gravida diam in lorem venenatis fermentum. ', getdate())
insert into test(descripcion, fecha) values('Donec suscipit odio ut leo fermentum lacinia.', getdate())
insert into test(descripcion, fecha) values('Aenean laoreet feugiat nunc vel rutrum.', getdate())
insert into test(descripcion, fecha) values('Nam at tellus erat. In ante elit, imperdiet sit amet eleifend vitae, fermentum a urna.', getdate())
insert into test(descripcion, fecha) values('Phasellus pellentesque placerat pellentesque.', getdate())
insert into test(descripcion, fecha) values('Sed et sapien dignissim, lacinia arcu ac, suscipit elit.', getdate())
insert into test(descripcion, fecha) values('Fusce ullamcorper mi ut lorem cursus, sed euismod nunc auctor. ', getdate())
insert into test(descripcion, fecha) values('Mauris id massa eget ligula efficitur pellentesque.', getdate())
GO

CREATE PROC USP_Test_List
AS
BEGIN
	SELECT * FROM test
END
GO

CREATE PROC USP_Test_ListById (@id int)
AS
BEGIN
	SELECT * FROM test where id = @id
END
</code></pre>

<hr />

<h3 id="paso-1-archivo-de-configuración">Paso 1: Archivo de configuración</h3>

<p>Empezaremos creando un archivo al cual nombraremos como <code>config.js</code>, en este archivo se encontrará la cadena de conexión.</p>

<pre><code>const config = {
    connectionSQL: &quot;Data Source=[server];Initial Catalog=[database];Persist Security Info=True;User ID=[user];Password=[pass];&quot;
}

module.exports = config;
</code></pre>

<hr />

<h3 id="paso-2-conexión-y-operaciones">Paso 2: Conexión y operaciones</h3>

<p>Creamos un nuevo archivo al cual nombraremos como <code>sql.js</code>, en este archivo crearemos la conexión y las operaciones básicas (select, exec store-procedure).</p>

<pre><code>&quot;use strict&quot;;

const mssql = require('mssql');

module.exports = class Sql {
    constructor(stringConnection) {
        this.stringConnection = stringConnection;
    }

    connect() {
        mssql.on('error', err =&gt; {
            console.log(err);
            mssql.close();
        });

        return mssql.connect(this.stringConnection);
    }

    close() {
        return mssql.close();
    }

    async select(table) {
        return new Promise((resolve, reject) =&gt; {
            this.connect().then(pool =&gt; {
                return pool.request().query(`select * from ${table}`);
            }).then(result =&gt; {
                mssql.close();
                resolve(result);
            }).catch(err =&gt; {
                reject(err);
            });
        });
    }

    async selectById(table, id) {
        if (id == undefined || id === 0) {
            return await this.select(table);
        } else {
            return new Promise((resolve, reject) =&gt; {
                this.connect().then(pool =&gt; {
                    return pool.request().query(`select * from ${table} where id=${id}`);
                }).then(result =&gt; {
                    mssql.close();
                    resolve(result);
                }).catch(err =&gt; {
                    reject(err);
                });
            });
        }
    }

    async execStoreProcedure(storeProcedure){
        return new Promise((resolve, reject) =&gt; {
            this.connect().then(pool =&gt; {
                return pool.request().execute(storeProcedure);
            }).then(result =&gt; {
                mssql.close();
                resolve(result);
            }).catch(err =&gt; {
                reject(err);
            });
        });
    }

    async execStoreProcedureById(storeProcedure, parameter){
        return new Promise((resolve, reject) =&gt; {
            this.connect().then(pool =&gt; {
                return pool.request()
                    .input(&quot;id&quot;, mssql.Int, parameter)
                    .execute(storeProcedure);
            }).then(result =&gt; {
                mssql.close();
                resolve(result);
            }).catch(err =&gt; {
                reject(err);
            });
        });
    }

}
</code></pre>

<hr />

<h3 id="paso-3-ejecuciones">Paso 3: Ejecuciones</h3>

<p>Para ejecutar crearemos una funcion asincrona autoejecutable de la siguiente manera:</p>

<pre><code>&quot;use strict&quot;;

const config = require(&quot;./config&quot;);
const sqlConnection = require(&quot;./sql&quot;);
const sql = new sqlConnection(config.connectionSQL);

(async () =&gt; {
    try {
        let select = await sql.select(&quot;test&quot;);
        console.log(select.recordset);
    } catch (error) {
        sql.close();
        console.log(error);
    }
})();
</code></pre>

<p>Ejecución de store procedure.</p>

<pre><code>&quot;use strict&quot;;

const config = require(&quot;./config&quot;);
const sqlConnection = require(&quot;./sql&quot;);
const sql = new sqlConnection(config.connectionSQL);

(async () =&gt; {
    try {
        let select = await sql.execStoreProcedureById(&quot;USP_Test_ListById&quot;, 1);
        console.log(select.recordset);
    } catch (error) {
        sql.close();
        console.log(error);
    }
})();
</code></pre>

<ul>
<li>Para verlo en acción solo debemos de ejecutar lo siguiente en la consola: <code>node [nombre-archivo].js</code></li>
<li>El retorno siempre es en formato JSON</li>
</ul>

<blockquote>
<p>Para obtener el código completo dar click <a href="https://github.com/PORTAFOLIO-PROYECTOS/NODE_JS_SQLSERVER/archive/master.zip">aquí</a></p>

<h4 id="comenta-disfruta-y-comparte">Comenta, disfruta y comparte!</h4>
</blockquote>

        </div>

        
        
      </div>
    </div>
  </div>
</section>



<footer>
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 text-center mb-5">
        <a href="https://examplesite.com"><img src="https://examplesite.com/images/logo.png" alt="El Programador | Blog personal"></a>
      </div>
               
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Contáctame</h6>
        <ul class="list-unstyled">
          
                     
          <li class="mb-3"><i class="ti-location-pin mr-3 text-primary"></i>Lima, Perú</li>
          
                     
          <li class="mb-3"><a class="text-dark" href="mailto:hugo.rock20@hotmail.com"><i
                class="ti-email mr-3 text-primary"></i>hugo.rock20@hotmail.com</a>
          
          </li>
        </ul>
      </div>
      
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Redes Sociales</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="mailto:hugo.rock20@hotmail.com">Email</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://twitter.com/HuugooRoca">twitter</a></li>
          
          <li class="mb-3"><a class="text-dark" href="skype:hugo.rock20?chat">Skype</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://github.com/HugoRoca">Github</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://www.linkedin.com/in/hugoroca/">Linkedin</a></li>
          
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Categorias</h6>
        <ul class="list-unstyled">
          <li class="mb-3"><a class="text-dark"
              href="/categories/base-de-datos">Base de datos</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/sistemas">Sistemas</a>
          </li>
          <li class="mb-3"><a class="text-dark"
              href="/categories/tutoriales">Tutoriales</a>
          </li>
        </ul>
      </div>
      <div class="col-lg-3 col-sm-6 mb-5">
        <h6 class="mb-4">Enlaces Rápidos</h6>
        <ul class="list-unstyled">
          
          <li class="mb-3"><a class="text-dark" href="https://examplesite.com/about">Acerca</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://examplesite.com/blog">Post</a></li>
          
          <li class="mb-3"><a class="text-dark" href="https://examplesite.com/contact">Contacto</a></li>
          
        </ul>
      </div>
      <div class="col-12 border-top py-4 text-center">
        | copyright &copy; 2021 <a href="https://gohugo.io/">Hugo</a> All Rights Reserved |
      </div>
    </div>
  </div>
</footer>

<script>
  var indexURL = "https://examplesite.com/index.json"
</script>

<!-- JS Plugins -->

<script src="https://examplesite.com/plugins/jQuery/jquery.min.js"></script>

<script src="https://examplesite.com/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://examplesite.com/plugins/slick/slick.min.js"></script>

<script src="https://examplesite.com/plugins/venobox/venobox.min.js"></script>

<script src="https://examplesite.com/plugins/search/fuse.min.js"></script>

<script src="https://examplesite.com/plugins/search/mark.js"></script>

<script src="https://examplesite.com/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://examplesite.com/js/script.min.js"></script>

<script type="text/javascript">
  $(document).ready(function() {
    hljs.initHighlightingOnLoad();
    

    $('pre code').each(function(i, block) {
      hljs.highlightBlock(block);
    });

    
    
    
  });
</script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js"></script>
<div id="js-cookie-box" class="cookie-box cookie-box-hide">
	Este sitio utiliza cookies. Si continúa utilizando este sitio web, acepte su uso. <span id="js-cookie-button" class="btn btn-sm btn-primary ml-2">Acepto</span>
</div>
<script>
	(function ($) {
		const cookieBox = document.getElementById('js-cookie-box');
		const cookieButton = document.getElementById('js-cookie-button');
		if (!Cookies.get('cookie-box')) {
			cookieBox.classList.remove('cookie-box-hide');
			cookieButton.onclick = function () {
				Cookies.set('cookie-box', true, {
					expires:  2 
				});
				cookieBox.classList.add('cookie-box-hide');
			};
		}
	})(jQuery);
</script>


<style>
.cookie-box {
  position: fixed;
  left: 0;
  right: 0;
  bottom: 0;
  text-align: center;
  z-index: 9999;
  padding: 1rem 2rem;
  background: rgb(71, 71, 71);
  transition: all .75s cubic-bezier(.19, 1, .22, 1);
  color: #fdfdfd;
}

.cookie-box-hide {
  display: none;
}
</style>
</body>
</html>